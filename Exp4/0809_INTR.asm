PB_8255 EQU 0602H
CTR_8255 EQU 0606H
PORT_0809 EQU 0640H
ICW1_8259 EQU 0020H
ICW2_8259 EQU 0021H
ICW4_8259 EQU 0021H
OCW1_8259 EQU 0021H

IR6_INTR_ADDR EQU 38H

WAITING EQU 1
IDLE EQU 0

DATA SEGMENT
	WAITFG DB 0
DATA ENDS

CODE SEGMENT
	ASSUME CS:CODE, DS:DATA
MAIN PROC FAR
	
	MOV AX, DATA
	MOV DS, AX
	
	MOV DX, CTR_8255
	MOV AL, 10000000B
	OUT DX, AL
	
	CLI
	
	MOV DX, ICW1_8259
	MOV AL, 00010011B
	OUT DX, AL
	
	MOV DX, ICW2_8259
	MOV AL, 00001000B
	OUT DX, AL
	
	MOV DX, ICW4_8259
	MOV AL, 00000111B
	OUT DX, AL
	
	MOV DX, OCW1_8259
	MOV AL, 10101111B
	OUT DX, AL
	
	STI

	CLI
	MOV AX, 0
	MOV ES, AX
	MOV DI, IR6_INTR_ADDR
	MOV AX, OFFSET IR6
	CLD
	STOSW
	MOV AX, SEG IR6
	STOSW
	STI
	
	;MOV DX, PB_8255
	;MOV AL, 10100011B
	;OUT DX, AL
	
	
	MOV WAITFG, IDLE
	
AA1:
	CMP WAITFG, WAITING
	JZ AA1
	MOV WAITFG, 1
	MOV DX, PORT_0809
	MOV AL, 0
	OUT DX, AL
	JMP AA1
	;MOV CX, 0FFH
	;LOOP $
	;IN AL, DX
	
	;MOV DX, PB_8255
	;OUT DX, AL
	;JMP AA1
	
	
	
EXIT:
	MOV AH, 4CH
	INT 21H
MAIN ENDP

IR6 PROC FAR
	;MOV BX, 0ABCDH
	MOV DX, PORT_0809
	IN AL, DX
	MOV DX, PB_8255
	OUT DX, AL
	MOV WAITFG, IDLE
	IRET
IR6 ENDP
          
CODE ENDS
END MAIN