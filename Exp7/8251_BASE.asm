SOURCE_ADDR EQU 3000H
TARGET_ADDR EQU 4000H
DATA_8251 EQU 0600H
CTR_8251 EQU 0602H
PORT2_8254 EQU 06C4H
CTR_8254 EQU 06C6H

CODE SEGMENT
	ASSUME CS:CODE
START:
	
	;初始化8254
	MOV DX,CTR_8254
	MOV AL,10110110B
	OUT DX,AL
	
	MOV DX,PORT2_8254
	
	MOV AX, 10
	
	OUT DX,AL
	MOV AL, AH
	OUT DX,AL
	
	MOV CX, 10
	MOV AX, 0ABC0H
	MOV SI, SOURCE_ADDR
	MOV DI, TARGET_ADDR
	
	;3000H处初始化，4000H处清零
	
INIT:
	MOV WORD PTR[DI], 0
	MOV [SI], AX
	INC AX
	INC SI
	INC SI
	INC DI
	INC DI
	LOOP INIT
	
	MOV DX, CTR_8251
	MOV AL, 11111111B
	OUT DX, AL
	
	MOV DX, CTR_8251
	MOV AL, 11111111B
	OUT DX, AL
	
	MOV DX, CTR_8251
	MOV AL, 01111110B
	OUT DX, AL
	
	MOV DX, CTR_8251
	MOV AL, 00110111B
	OUT DX, AL
	
	MOV CX, 20
	MOV SI, SOURCE_ADDR
	MOV DI, TARGET_ADDR
	
	
LOP:
	;MOV DX, CTR_8251
	
	;IN AL, DX
	;AND AL, 01H	;TXRDY?
	;JZ LOP
	
	MOV DX, DATA_8251
	MOV AL, [SI]
	OUT DX, AL
	
	INC SI
	
	
AA2:
	MOV DX, CTR_8251
	IN AL, DX
	AND AL, 01H	;TXRDY?
	JZ AA2
	
	PUSH CX
	MOV CX, 000FFH
	LOOP $
	POP CX
	
AA1:
	MOV DX, CTR_8251
	IN AL, DX
	TEST AL, 02H
	JZ AA1
	
	;TEST AL, 38H
	
	MOV DX, DATA_8251
	IN AL, DX
	
	MOV [DI], AL
	INC DI
	
	LOOP LOP
	
	
	MOV AH, 4CH
	INT 21H
CODE ENDS
	END START