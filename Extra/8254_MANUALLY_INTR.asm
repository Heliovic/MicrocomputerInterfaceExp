PB_8255 EQU 0602H
CTR_8255 EQU 0606H

PORT0_8254 EQU 0640H
CTR_8254 EQU 0646H

ICW1_8259 EQU 0020H
ICW2_8259 EQU 0021H
ICW4_8259 EQU 0021H
OCW1_8259 EQU 0021H

IR6_INTR_ADDR EQU 38H

CODE SEGMENT
	ASSUME CS:CODE
MAIN PROC FAR

	MOV DX, CTR_8255
	MOV AL, 10000000B
	OUT DX, AL
	
	CLI
	
	MOV DX, ICW1_8259
	MOV AL, 00010011B
	OUT DX, AL
	
	MOV DX, ICW2_8259
	MOV AL, 00001000B
	OUT DX, AL
	
	MOV DX, ICW4_8259
	MOV AL, 00000111B
	OUT DX, AL
	
	MOV DX, OCW1_8259
	MOV AL, 00101111B
	OUT DX, AL
	
	STI

	CLI
	MOV AX, 0
	MOV ES, AX
	MOV DI, IR6_INTR_ADDR
	MOV AX, OFFSET IR6
	CLD
	STOSW
	MOV AX, SEG IR6
	STOSW
	STI
	
	MOV DX, CTR_8254
	MOV AL, 00110000B
	OUT DX, AL
	
	MOV AX, 6
	
	MOV DX, PORT0_8254
	OUT DX, AL
	
	MOV AL, AH
	
	MOV DX, PORT0_8254
	OUT DX, AL
	
DEAD_LOOP:
	;MOV DX, PB_8255
	;MOV AL, 0FFH
	;OUT DX, AL
	JMP DEAD_LOOP
	JMP DEAD_LOOP
	
EXIT:
	MOV AH, 4CH
	INT 21H
MAIN ENDP

DELAY PROC FAR
	PUSH CX
	MOV CX, 0FFFFH
	LOOP $
	MOV CX, 0FFFFH
	LOOP $
	MOV CX, 0FFFFH
	LOOP $
	MOV CX, 0FFFFH
	LOOP $
	MOV CX, 0FFFFH
	LOOP $
	MOV CX, 0FFFFH
	LOOP $
	MOV CX, 0FFFFH
	LOOP $
	MOV CX, 0FFFFH
	LOOP $
	MOV CX, 0FFFFH
	LOOP $
	MOV CX, 0FFFFH
	LOOP $
	MOV CX, 0FFFFH
	LOOP $
	MOV CX, 0FFFFH
	LOOP $
	MOV CX, 0FFFFH
	LOOP $
	MOV CX, 0FFFFH
	LOOP $
	MOV CX, 0FFFFH
	LOOP $
	POP CX
	RET
DELAY ENDP

IR6 PROC FAR
	PUSH AX
	PUSH DX
	
	MOV DX, PB_8255
	MOV AL, 0FFH
	OUT DX, AL
	
	POP DX
	POP AX
	IRET
IR6 ENDP

CODE ENDS
END MAIN