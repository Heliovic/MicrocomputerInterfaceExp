PB_8255 EQU 0642H
CTR_8255 EQU 0646H
ICW1_8259 EQU 0020H
ICW2_8259 EQU 0021H
ICW4_8259 EQU 0021H
OCW1_8259 EQU 0021H
OCW2_8259 EQU 0020H

IR6_INTR_ADDR EQU 38H
IR7_INTR_ADDR EQU 3CH

CODE SEGMENT
	ASSUME CS:CODE
MAIN PROC FAR

	MOV DX, CTR_8255
	MOV AL, 10000000B
	OUT DX, AL
	
	CLI
	
	MOV DX, ICW1_8259
	MOV AL, 00010011B
	OUT DX, AL
	
	MOV DX, ICW2_8259
	MOV AL, 00001000B
	OUT DX, AL
	
	MOV DX, ICW4_8259
	MOV AL, 00000111B
	OUT DX, AL
	
	MOV DX, OCW1_8259
	MOV AL, 00101111B
	OUT DX, AL
	
	MOV DX, OCW2_8259
	MOV AL, 00100000B
	OUT DX, AL
	
	STI

	CLI
	MOV AX, 0
	MOV ES, AX
	MOV DI, IR6_INTR_ADDR
	MOV AX, OFFSET IR6
	CLD
	STOSW
	MOV AX, SEG IR6
	STOSW
	STI
	
	CLI
	MOV AX, 0
	MOV ES, AX
	MOV DI, IR7_INTR_ADDR
	MOV AX, OFFSET IR7
	CLD
	STOSW
	MOV AX, SEG IR7
	STOSW
	STI
	
DEAD_LOOP:
	MOV DX, PB_8255
	MOV AL, 0FFH
	OUT DX, AL
	MOV CX, 0FFFFH
	LOOP $
	JMP DEAD_LOOP
	
EXIT:
	MOV AH, 4CH
	INT 21H
MAIN ENDP

IR6 PROC FAR
	PUSH AX
	PUSH CX
	PUSH DX
	STI
	
	MOV CX, 0FFFFH
L1:
	MOV DX, PB_8255
	MOV AL, 0FH
	OUT DX, AL
	LOOP L1
	
	MOV CX, 0FFFFH
L2:
	MOV DX, PB_8255
	MOV AL, 0FH
	OUT DX, AL
	LOOP L2
	
	MOV CX, 0FFFFH
L3:
	MOV DX, PB_8255
	MOV AL, 0FH
	OUT DX, AL
	LOOP L3
	
L4:
	MOV DX, PB_8255
	MOV AL, 0FH
	OUT DX, AL
	LOOP L4
	
	POP DX
	POP CX
	POP AX
	IRET
IR6 ENDP

IR7 PROC FAR
	PUSH AX
	PUSH CX
	PUSH DX
	STI
	
	MOV CX, 0FFFFH
L9:
	MOV DX, PB_8255
	MOV AL, 0F0H
	OUT DX, AL
	LOOP L9
	
	MOV CX, 0FFFFH
L10:
	MOV DX, PB_8255
	MOV AL, 0F0H
	OUT DX, AL
	LOOP L10
	
	MOV CX, 0FFFFH
L11:
	MOV DX, PB_8255
	MOV AL, 0F0H
	OUT DX, AL
	LOOP L11
	
L12:
	MOV DX, PB_8255
	MOV AL, 0F0H
	OUT DX, AL
	LOOP L12
	
	POP DX
	POP CX
	POP AX
	IRET
IR7 ENDP

CODE ENDS
END MAIN