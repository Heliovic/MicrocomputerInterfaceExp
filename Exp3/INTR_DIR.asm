PB_8255 EQU 0642H
CTR_8255 EQU 0646H
ICW1_8259 EQU 0020H
ICW2_8259 EQU 0021H
ICW4_8259 EQU 0021H
OCW1_8259 EQU 0021H

IR6_INTR_ADDR EQU 38H
IR7_INTR_ADDR EQU 3CH

RIGHT EQU 0
LEFT EQU 1

DATA SEGMENT
	DIR DB 0	;0: RIGHT, 1: LEFT
DATA ENDS

CODE SEGMENT
	ASSUME CS:CODE, DS:DATA
MAIN PROC FAR

	MOV AX, DATA
	MOV DS, AX

	MOV DX, CTR_8255
	MOV AL, 10000000B
	OUT DX, AL
	
	CLI
	
	MOV DX, ICW1_8259
	MOV AL, 00010011B
	OUT DX, AL
	
	MOV DX, ICW2_8259
	MOV AL, 00001000B
	OUT DX, AL
	
	MOV DX, ICW4_8259
	MOV AL, 00000111B
	OUT DX, AL
	
	MOV DX, OCW1_8259
	MOV AL, 00101111B
	OUT DX, AL
	
	STI

	CLI
	MOV AX, 0
	MOV ES, AX
	MOV DI, IR6_INTR_ADDR
	MOV AX, OFFSET IR6
	CLD
	STOSW
	MOV AX, SEG IR6
	STOSW
	STI
	
	CLI
	MOV AX, 0
	MOV ES, AX
	MOV DI, IR7_INTR_ADDR
	MOV AX, OFFSET IR7
	CLD
	STOSW
	MOV AX, SEG IR7
	STOSW
	STI
	
	MOV AL, 08H
	
AA1:
	MOV DL, DIR
	AND DL, 01H
	CMP DL, LEFT
	JZ LEF
RIG:
	CMP AL, 01H	;AL 在最右端
	JZ AA1
	SHR AL, 1
	MOV DX, PB_8255
	OUT DX, AL
	MOV CX, 0FFFFH
	LOOP $
	JMP AA1
LEF:
	CMP AL, 80H	;AL 在最左端
	JZ AA1
	SHL AL, 1
	MOV DX, PB_8255
	OUT DX, AL
	MOV CX, 0FFFFH
	LOOP $
	JMP AA1
	
EXIT:
	MOV AH, 4CH
	INT 21H
MAIN ENDP

IR6 PROC FAR
	;STI
	MOV DIR, LEFT
	IRET
IR6 ENDP

IR7 PROC FAR
	;STI
	MOV DIR, RIGHT
	IRET
IR7 ENDP

CODE ENDS
END MAIN